<!-- Add this to existing System Configuraiton object! -->
<infrastructure>
    <publicHttpUrlPattern>https://mymidpoint.edu/midpoint</publicHttpUrlPattern>
</infrastructure>

<notificationConfiguration>
        <handler>
            <userRegistrationNotifier>
                <recipientExpression>
                    <script xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="c:ScriptExpressionEvaluatorType">
                        <code>
                    return requestee.getEmailAddress()
                  </code>
                    </script>
                </recipientExpression>
                <bodyExpression>
                    <script>
                        <code>

                                import com.evolveum.midpoint.notifications.api.events.ModelEvent
                                modelEvent = (ModelEvent) event
                                newUser = modelEvent.getFocusContext().getObjectNew();
                                userType = newUser.asObjectable();

                                plainTextPassword = midpoint.getPlaintextUserPassword(userType);

                                bodyMessage = "Dear " + userType.getGivenName() + ",\n\n" +
                                    "your account was successfully created at this university! To activate your account, click on the confirmation link below." +
                                    "\n" +
                                    "After your account is activated, use following credentials to log in: \n" +
                                    "username: " + userType.getName().getOrig() + "\n" +
                                    "password: " + plainTextPassword+ "\n\n" +
                                    midpoint.createRegistrationConfirmationLink(userType);

                                return bodyMessage;
                            </code>
                    </script>
                </bodyExpression>
                <transport>mail</transport>
                <confirmationMethod>link</confirmationMethod>
            </userRegistrationNotifier>
        </handler>
    <!-- This is same mail server config as password reset, add if doesn't already exist. -->
    <mail>
        <server>
        <host>mailhog</host>
        <port>1025</port>
        </server>
        <defaultFrom>adminmail@example.edu</defaultFrom>
        <debug>true</debug>
    </mail>
</notificationConfiguration>
