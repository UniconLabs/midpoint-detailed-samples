<?xml version="1.0"?>
<securityPolicy xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
                xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
                xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3"
                xmlns:org="http://midpoint.evolveum.com/xml/ns/public/common/org-3"
                xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
                xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3"
                xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                oid="00000000-0000-0000-0000-000000000120">
    <name>Default Security Policy</name>
    <iteration>0</iteration>
    <iterationToken/>
    <authentication>
        <modules>
            <loginForm id="1">
                <name>internalLoginForm</name>
                <description>Internal username/password authentication, default user password, login form</description>
            </loginForm>
            <httpBasic id="2">
                <name>internalBasic</name>
                <description>Internal username/password authentication, using HTTP basic auth</description>
            </httpBasic>
            <saml2 id="3">
                <name>mySamlSso</name>
                <description>My internal enterprise SAML-based SSO system.</description>
                <serviceProvider id="16">
                    <entityId>https://idm.myurl.edu</entityId>
                    <alias>spmidpoint</alias>
                    <signRequests>false</signRequests>
                    <keys>
                        <activeSimpleKey>
                            <privateKey>
                                <t:clearValue>-----BEGIN RSA PRIVATE KEY-----
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
-----END RSA PRIVATE KEY-----
</t:clearValue>
                            </privateKey>
                            <passphrase>
                                <t:clearValue>password</t:clearValue>
                            </passphrase>
                            <certificate>
                                <t:clearValue>-----BEGIN CERTIFICATE-----
MIIEJzCCAo+gAwIBAgIUSFMXMDPNf5R7fcbLzy9aI6j6rnUwDQYJKoZIhvcNAQEL
BQAwGjEYMBYGA1UEAwwPc3NvLmV4YW1wbGUuZWR1MB4XDTIxMDgxNjIwNTU0NFoX
DTQxMDgxNjIwNTU0NFowGjEYMBYGA1UEAwwPc3NvLmV4YW1wbGUuZWR1MIIBojAN
BgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAhRooUVvMOocnVUTj4jov/qd6knyy
GACYnGttoyxD8yGICaZn26DJViORoZ81/38ZTclwTunbxnXqVmpRJ0C8ATtTIIQU
2LPyFCIYuwuqAPJk2NkTtfBLvc2y5drT6Cy7jZZWOg1QYhyk7DN+FrXSPYh3ZgtK
0yMHc4Qn4Rz6DUJetKm6LO1R2jXh9WoQwysuzfxTUikJEufJ0RuxVo5wTys8jXPp
6e7S7iJjo2IySATOSI/x055DPF3F1PQLirDyxO8dVn2jMW79rACWvBAMRM8AAfEa
2Tl1I+QfpDyqaOzS3RlNEUuVXvsyYJ9aaBQTxUx/eOmaMs2P4qhIxkJe3dG2hkG8
CSdAxVbXd5JDbsVNHkjVSI/eWPWRI3K9W1MOl+rGFYA3tLeSlVEZwa0ayMc1QaCt
Pj9xwUWKCiGZ4tzz6kkxjzOKmrJzhw72i6Fam3wTUnZRKe282GNJZwzLw2aM2wJv
Zq6gsX0UnTqpmbufmmNDUQ1QNuZKIj1SRPObAgMBAAGjZTBjMB0GA1UdDgQWBBT9
foMJfH4k/SE64eEIvgQhqiUZbDBCBgNVHREEOzA5gg9zc28uZXhhbXBsZS5lZHWG
Jmh0dHBzOi8vc3NvLmV4YW1wbGUuZWR1L2lkcC9zaGliYm9sZXRoMA0GCSqGSIb3
DQEBCwUAA4IBgQACsSa40iY8yzpZwWU1FNF0PEhG6CXp8cVl7OOJ02Gji2SwoRFD
OIMQKag0HYtfw1NR6UWC3z9X4cQAdIbWJPTmXGQiOoClIHKbO9RJlcg0hRWnlXu3
Lod6kq+0/DGyVcC6GLPdOHOtwRC/CKzRpq985db0vN5Is3GvpFX0NKC4ADlA/Pa6
1L9rgapMqtUi8aK96p5w3Ig0mIncho8jNkCPq8v8hKUBP92JT4o2zDGJsunsO/tp
qT0qsa1ZXwCyqy0fU4TUXgalLI+GU9r5LDm3OPn1e6UfRKzWGtHkoctSTIg7cp+w
JdknW3Zq8Xf4+zFKQoZgzERsLFY5Tm73d47o2DxhCz60GXFBabwKSpOoTcxK1sNG
UpzRlTXBHeJTsonDQ/+5s2MGsyidhVFCDLC9tPsYjBq+ymgqTwcPNGG9/L06KoeR
riOVsNPbIvX9IX3eA5z+1BCBvpQ+lFEeoVDRH7d6ItHktC6QzIHfLLhj2SxdLA30
ltrVa6Q7hir9L28=
-----END CERTIFICATE-----
</t:clearValue>
                            </certificate>
                        </activeSimpleKey>
                    </keys>
                    <identityProvider>
                        <entityId>https://idp.myurl.edu</entityId>
                        <metadata>
                            <pathToFile>/opt/midpoint/var/metadata/idp-metadata.xml</pathToFile>
                        </metadata>
                        <linkText>Shibboleth</linkText>
                        <authenticationRequestBinding>urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST</authenticationRequestBinding>
                        <nameOfUsernameAttribute>uid</nameOfUsernameAttribute>
                    </identityProvider>
                </serviceProvider>
            </saml2>
            <mailNonce id="4">
                <name>registrationMail</name>
                <description>Authentication based on mail message with a nonce. Used for user registration.</description>
                <credentialName>mailNonce</credentialName>
            </mailNonce>
            <smsNonce id="5">
                <name>passwordResetSms</name>
                <description>Authentication based on SMS message with a nonce. Used for password resets.</description>
                <credentialName>smsNonce</credentialName>
                <mobileTelephoneNumberItemPath>extension/mobile</mobileTelephoneNumberItemPath>
            </smsNonce>
            <securityQuestionsForm id="6">
                <name>SecQ</name>
                <description>
                    This is interactive, form-based authentication by using security questions.
                </description>
            </securityQuestionsForm>
            <httpSecQ id="7">
                <name>httpSecQ</name>
                <description>
                    Special "HTTP SecQ" authentication based on security question answers.
                    It is used for REST service.
                </description>
            </httpSecQ>
        </modules>
        <sequence id="8">
            <name>admin-gui-default</name>
            <description>
                Default GUI authentication sequence.
                We want to try company SSO, federation and internal. In that order.
                Just one of then need to be successful to let user in.
            </description>
            <channel>
                <channelId>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channelId>
                <default>true</default>
                <urlSuffix>default</urlSuffix>
            </channel>
            <module id="12">
                <name>mySamlSso</name>
                <order>30</order>
                <necessity>sufficient</necessity>
            </module>
        </sequence>
        <sequence id="9">
            <name>admin-gui-emergency</name>
            <description>
                Special GUI authentication sequence that is using just the internal user password.
                It is used only in emergency. It allows to skip SAML authentication cycles, e.g. in case
                that the SAML authentication is redirecting the browser incorrectly.
            </description>
            <channel>
                <channelId>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channelId>
                <default>false</default>
                <urlSuffix>emergency</urlSuffix>
            </channel>
            <requireAssignmentTarget oid="00000000-0000-0000-0000-000000000004" relation="org:default" type="c:RoleType">
                <!-- Superuser -->
            </requireAssignmentTarget>
            <module id="14">
                <name>internalLoginForm</name>
                <order>30</order>
                <necessity>sufficient</necessity>
            </module>
        </sequence>
        <sequence id="17">
            <name>rest</name>
            <description>
                Authentication sequence for REST service.
            </description>
            <channel>
                <channelId>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#rest</channelId>
                <default>true</default>
                <urlSuffix>rest-default</urlSuffix>
            </channel>
            <module id="19">
                <name>internalBasic</name>
                <order>10</order>
                <necessity>sufficient</necessity>
            </module>
        </sequence>
        <sequence id="18">
            <name>actuator</name>
            <description>
                Authentication sequence for actuator.
            </description>
            <channel>
                <channelId>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#actuator</channelId>
                <default>true</default>
                <urlSuffix>actuator-default</urlSuffix>
            </channel>
            <module id="20">
                <name>internalBasic</name>
                <order>10</order>
                <necessity>sufficient</necessity>
            </module>
        </sequence>
        <ignoredLocalPath>/actuator</ignoredLocalPath>
        <ignoredLocalPath>/actuator/health</ignoredLocalPath>
    </authentication>
    <credentials>
        <password>
            <minOccurs>0</minOccurs>
            <lockoutMaxFailedAttempts>3</lockoutMaxFailedAttempts>
            <lockoutFailedAttemptsDuration>PT3M</lockoutFailedAttemptsDuration>
            <lockoutDuration>PT15M</lockoutDuration>
            <valuePolicyRef xmlns:tns="http://midpoint.evolveum.com/xml/ns/public/common/common-3" oid="00000000-0000-0000-0000-000000000003" relation="org:default" type="tns:ValuePolicyType">
                <!-- Default Password Policy -->
            </valuePolicyRef>
        </password>
    </credentials>
</securityPolicy>
