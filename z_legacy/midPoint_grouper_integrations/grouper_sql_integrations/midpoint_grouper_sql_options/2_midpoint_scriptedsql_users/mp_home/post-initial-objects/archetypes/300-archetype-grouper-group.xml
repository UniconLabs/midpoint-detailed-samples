<archetype xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
           xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
           xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3"
           xmlns:org="http://midpoint.evolveum.com/xml/ns/public/common/org-3"
           xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
           xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3"
           xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:ext="http://midpoint-grouper-integration.itap.internet2.edu"
           oid="81f30e37-f7d5-4153-9c96-f049dd144e19" version="0">
    <name>Grouper Group Archetype</name>
    <archetypePolicy>
        <display>
            <label>Grouper Group</label>
            <pluralLabel>Grouper Groups</pluralLabel>
            <icon>
                <cssClass>fa fa-users</cssClass>
                <color>lightcoral</color>
            </icon>
        </display>
    </archetypePolicy>
    <inducement>
        <focusType>OrgType</focusType>
        <focusMappings>
            <mapping>
                <name>parentOrg</name>
                <description>This mapping fills in and creates if necessary the parent org assignment based on the Grouper Group Id (e.g. test:stuff:anotherfolder:mygroup)</description>
                <strength>strong</strength>
                <source>
                    <path>$focus/extension/grouperParentName</path>
                </source>
                <expression>
                    <assignmentTargetSearch>
                        <targetType>c:OrgType</targetType>
                        <filter>
                            <q:equal>
                                <q:path>c:name</q:path>
                                <expression>
                                    <script>
                                        <code>grouperParentName</code>
                                    </script>
                                </expression>
                            </q:equal>
                        </filter>
                        <assignmentProperties xsi:type="c:AssignmentPropertiesSpecificationType">
                            <subtype>group-group</subtype>
                        </assignmentProperties>
                    </assignmentTargetSearch>
                </expression>
                <target>
                    <path>assignment</path>
                </target>
                <condition>
                    <script>
                        <code>basic.getExtensionPropertyValue(focus, 'grouperParentName')?.trim()</code>
                    </script>
                </condition>
            </mapping>
            <mapping>
                <name>topParentOrg</name>
                <strength>strong</strength>
                <expression>
                    <assignmentTargetSearch>
                        <targetType>c:OrgType</targetType>
                        <oid>dd860fc2-a8ae-4657-8f05-9a32adae279b</oid>
                        <assignmentProperties xsi:type="c:AssignmentPropertiesSpecificationType">
                            <subtype>group-group</subtype>
                        </assignmentProperties>
                    </assignmentTargetSearch>
                </expression>
                <target>
                    <path>assignment</path>
                </target>
                <condition>
                    <script>
                        <code>!basic.getExtensionPropertyValue(focus, 'grouperParentName')?.trim()</code>
                    </script>
                </condition>
            </mapping>
        </focusMappings>
        <!--
            Inducement order of 1 means these mappings are to be applied on org object, because the assignment structure should be this:
                org -> archetype
         -->
        <order>1</order>
    </inducement>
</archetype>
