<?xml version="1.0" encoding="UTF-8"?>
<!-- TODO by Unicon -->

<additionalConnector>
    <name>ssh</name>
    <connectorRef>
        <filter>
            <q:equal>
                <q:path>c:connectorType</q:path>
                <q:value>com.evolveum.polygon.connector.ssh.SshConnector</q:value>
            </q:equal>
        </filter>
    </connectorRef>
    <connectorConfiguration xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3">
        <icfc:configurationProperties xmlns:icfcps="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ssh/com.evolveum.polygon.connector.ssh.SshConnector">
            <icfcps:host>localhost</icfcps:host>
            <icfcps:username>jack</icfcps:username>
            <icfcps:password>
                <t:clearValue>secret</t:clearValue>
            </icfcps:password>
            <icfcps:argumentStyle>variables-bash</icfcps:argumentStyle>
        </icfc:configurationProperties>
        <icfc:resultsHandlerConfiguration>
            <icfc:enableNormalizingResultsHandler>false</icfc:enableNormalizingResultsHandler>
            <icfc:enableFilteredResultsHandler>false</icfc:enableFilteredResultsHandler>
            <icfc:enableAttributesToGetSearchResultsHandler>false</icfc:enableAttributesToGetSearchResultsHandler>
        </icfc:resultsHandlerConfiguration>
    </connectorConfiguration>
</additionalConnector>
<script>
<language>bash</language>
<argument>
    <name>identity</name>
    <c:path xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="t:ItemPathType">$user/name</c:path>
</argument>
<code>someScript.sh</code>
<operation>modify</operation>
<kind>account</kind>
<order>after</order>
<condition>
    <script xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="c:ScriptExpressionEvaluatorType">
        <code>
            import com.evolveum.midpoint.xml.ns._public.common.common_3.ActivationStatusType;
            import com.evolveum.midpoint.schema.constants.SchemaConstants;

            currentChange = midpoint.getFocusContext().getDelta().findPropertyDelta(SchemaConstants.PATH_ACTIVATION_ADMINISTRATIVE_STATUS)
            oldChange = midpoint.getFocusContext().getObjectOld()?.asObjectable()?.getActivation()?.getAdministrativeStatus()

            return ((currentChange != null &amp;&amp; oldChange != null) &amp;&amp; (currentChange != oldChange) &amp;&amp; currentChange.getItemNewMatchingPath(null).getRealValue() ==  ActivationStatusType.ENABLED)
        </code>
    </script>
</condition>
</script>